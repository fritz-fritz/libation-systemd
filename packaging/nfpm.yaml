name: libation-systemd
arch: all
platform: linux
version: ${TAG_VERSION}
section: misc
priority: optional
maintainer: FRITZ|FRITZ <code@fritztech.net>
description: |
  User systemd units and helpers to mount S3 storage via rclone
  and launch Libation with warm caches and clean teardown.
homepage: https://github.com/fritz-fritz/libation-systemd
license: GPL-3.0-or-later

contents:
  # systemd user units
  - src: systemd/user/libation.service
    dst: /usr/share/libation-systemd/systemd/user/libation.service
  - src: systemd/user/libation-s3.service
    dst: /usr/share/libation-systemd/systemd/user/libation-s3.service
  - src: systemd/user/libation-s3-warmup.service
    dst: /usr/share/libation-systemd/systemd/user/libation-s3-warmup.service
  - src: systemd/user/app-libation.slice
    dst: /usr/share/libation-systemd/systemd/user/app-libation.slice

  # env template and setup helper
  - src: config/env.example
    dst: /usr/share/libation-systemd/env.example
    file_info:
      mode: 0644
  - src: scripts/setup-libation-systemd
    dst: /usr/bin/setup-libation-systemd
    file_info:
      mode: 0755

overrides:
  deb:
    depends:
      - rclone (>= 1.60)
      - fuse3
      - libation
    recommends:
      - libnotify-bin
  rpm:
    depends:
      - rclone >= 1.60
      - fuse3
      - libation
    recommends:
      - libnotify

scripts:
  postinstall: ./scripts/postinstall.sh
